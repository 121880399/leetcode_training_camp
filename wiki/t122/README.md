# [122. 买卖股票的最佳时机 II](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/)

给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。

设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。

注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

示例 1:

```输入: [7,1,5,3,6,4]
输出: 7
解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。
     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。
```

示例 2:

```
输入: [1,2,3,4,5]
输出: 4
解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。
     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。
     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。
```

示例 3:

```
输入: [7,6,4,3,1]
输出: 0
解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。
```

提示：

```
1 <= prices.length <= 3 * 10 ^ 4
0 <= prices[i] <= 10 ^ 4
```

#### 1.解题思路

本题是121题的升级版本，121题只允许交易一次，而本题可以交易多次。我们以示例1为例，我们考察第5天时能够获取的最大利润是多少。

![](https://github.com/121880399/leetcode_training_camp/blob/master/wiki/t122/1.png)

我们声明一个变量i来记录当前的天数，由于数组是从0开始的，所以i的值会比实际天数少一。

当i=4时，我们发现有两种交易方式，第一种交易方式是在1块钱的时候买入，5块钱的时候卖出，获利4元，并且在3块钱的时候再次买入，6块钱的时候卖出，这样到i=4这一天，一共获利7元。另外一种交易方式就是在1块钱的时候买入，6块钱的时候卖出，一共获利5元。所以在i=4这一天要想获利最大，就得取这两种交易方式的最大值。

我们来将这两种交易方式翻译成代码，首先是第一种，第一种交易方式其实就是i-1时的最大获利加上在i-1时买入，i时卖出的价格。profitMax+(prices[i]-prices[i-1]),当然这里的前提是(prices[i]-prices[i-1])是一个大于0的数，否则会越加越小。第二种交易方式就跟121题一样，是用第i天的交易价格减去之前几天里最小花费价格，也就是prices[i]-costMin。

#### 2.代码实现

```java
 public int maxProfit(int[] prices) {
     	//最大获利
        int profitMax = 0;
     	//最少花费
        int costMin = -prices[0];
        for(int i=1;i<prices.length;i++){
            //前一天买入，当天卖出的利润
            int temp = prices[i]-prices[i-1];
            if(temp > 0) {
                profitMax = Math.max(profitMax+temp,costMin+prices[i]);
            }else{
                profitMax = Math.max(profitMax,costMin+prices[i]);
            }
            //得到最小花费
            costMin = Math.max(costMin,-prices[i]);
        }
        return profitMax;
    }
```

理解了解题思路，代码就很简单了，无非就是取两种交易方式的最大值。这里注意前一天买入，当天卖出后的利润如果是大于零才加入到利润里。